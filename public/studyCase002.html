<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>R pour les scientifiques : Mise en œuvre de projets et valorisation des résultats</title>
  <meta name="description" content="Un guide pour acquérir les bases de la programmation avec R et conduire efficacement la gestion et l’analyse de ses données." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="R pour les scientifiques : Mise en œuvre de projets et valorisation des résultats" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Un guide pour acquérir les bases de la programmation avec R et conduire efficacement la gestion et l’analyse de ses données." />
  <meta name="github-repo" content="frareb/myRBook_FR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R pour les scientifiques : Mise en œuvre de projets et valorisation des résultats" />
  
  <meta name="twitter:description" content="Un guide pour acquérir les bases de la programmation avec R et conduire efficacement la gestion et l’analyse de ses données." />
  

<meta name="author" content="François Rebaudo" />


<meta name="date" content="2020-06-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-124666641-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-124666641-2');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="myStyle.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R pour les scientifiques</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Contenus additionnels</b></span></li>
<li class="chapter" data-level="1" data-path="042_studyCase.html"><a href="#studyCase002"><i class="fa fa-check"></i><b>1</b> Internet, manipuler des URLs</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R pour les scientifiques : Mise en œuvre de projets et valorisation des résultats</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">R pour les scientifiques : Mise en œuvre de projets et valorisation des résultats</h1>
<p class="author"><em>François Rebaudo</em></p>
<p class="date"><em>2020-06-23</em></p>
</div>
<div id="studyCase002" class="section level1">
<h1><span class="header-section-number"> 1</span> Internet, manipuler des URLs</h1>
<p>Il peut être intéressant d’obtenir le numéro WOS d’un article scientifique. Ce numéro est cependant fastidieux à obtenir, d’autant plus si nous souhaitons le récupérer pour une liste d’articles ! Par chance <em>The Kitchin Research Group</em> dans leur blog de juin 2015 (<a href="http://kitchingroup.cheme.cmu.edu/blog/2015/06/08/Getting-a-WOS-Accession-number-from-a-DOI/" class="uri">http://kitchingroup.cheme.cmu.edu/blog/2015/06/08/Getting-a-WOS-Accession-number-from-a-DOI/</a>) propose une méthode pour récupérer le numéro WOS à partir du numéro DOI. C’est cette méthode que nous allons utiliser avec R et le package <code>httr</code>. En bref, cette méthode consite à interroger le site web du WOS à partir du numéro DOI. Le site web du WOS va répondre en spécifiant qu’il faut se connecter pour accéder à l’article. Il y a pour cela une redirection vers une page web dont l’URL contient le numéro WOS. Il suffit alors d’extraire le numéro WOS de l’URL de la page web. <strong>Si nous utilisons un proxy pour accéder au site web du WOS, il faut donc le désactiver pour que la méthode fonctionne</strong>.</p>
<p>Tout d’abord si cela n’est pas déjà fait il faut installer le package <code>httr</code> avec <code>install.packages(&quot;httr&quot;)</code>, puis le charger avec <code>library(&quot;httr&quot;)</code>. Une autre solution consiste à utiliser la fonction suivante qui va vérifier si le package est installé puis le charger (il existe de nombreuses déclinaisons de cette fonction sur internet, il s’agit ici d’un mélange de multiples sources).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">pkgCheck &lt;-<span class="st"> </span><span class="cf">function</span>(packages){</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">    <span class="cf">for</span>(x <span class="cf">in</span> packages){</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">        <span class="kw">try</span>(<span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(x, <span class="dt">character.only =</span> <span class="ot">TRUE</span>)){</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">            <span class="kw">install.packages</span>(x, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">            <span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(x, <span class="dt">character.only =</span> <span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">                <span class="kw">stop</span>()</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">            }</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">        })</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    }</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">pkgCheck</span>(<span class="st">&quot;httr&quot;</span>)</a></code></pre></div>
<p>La liste des numéros DOI est la suivante (contenu dans un <code>vector</code>) :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">myDOIs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="st">&quot;10.1111/2041-210X.12935&quot;</span>, </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="st">&quot;10.1007/s13355-017-0480-5&quot;</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">print</span>(myDOIs)</a></code></pre></div>
<pre><code>## [1] &quot;10.1111/2041-210X.12935&quot;   &quot;10.1007/s13355-017-0480-5&quot;</code></pre>
<p>Pour chaque DOI, nous allons interroger le site web du WOS, récupérer l’URL de redirection, puis récupérer le numéro WOS. Nous allons donc faire une boucle sur notre <code>vector</code> contenant les DOI. Nous utilisons la fonction <code>seq_along()</code> qui va prendre comme valeurs les éléments d’une séquence de 1 à la taille de l’objet <code>myDOIs</code>, soit : <code>i = 1</code>, puis <code>i = 2</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(myDOIs)){</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="co"># ...</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">}</a></code></pre></div>
<p>Dans la boucle, le DOI que nous allons traiter est donc <code>myDOIs[i]</code> que nous allons appeler <code>myDOI</code>. La page d’interrogation du WOS correspond à la concaténation de l’URL du WOS avec le numéro WOS (l’URL est présentée sur plusieurs lignes pour respecter la largeur de page de ce livre).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(myDOIs)){</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  myDOI &lt;-<span class="st"> </span>myDOIs[i]</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  myWebPage &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="st">&quot;http://ws.isiknowledge.com/&quot;</span>, </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    <span class="st">&quot;cps/openurl/service?url_ver=Z39.88-2004&quot;</span>, </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">    <span class="st">&quot;&amp;rft_id=info:doi/&quot;</span>, myDOI)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">}</a></code></pre></div>
<p>Maintenant nous allons utiliser la fonction <code>GET()</code> du package <code>httr</code> pour récupérer l’URL.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(myDOIs)){</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  myDOI &lt;-<span class="st"> </span>myDOIs[i]</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  myWebPage &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    <span class="st">&quot;http://ws.isiknowledge.com/&quot;</span>, </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="st">&quot;cps/openurl/service?url_ver=Z39.88-2004&quot;</span>, </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">    <span class="st">&quot;&amp;rft_id=info:doi/&quot;</span>, myDOI)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  r &lt;-<span class="st"> </span><span class="kw">GET</span>(myWebPage)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  urlWOS &lt;-<span class="st"> </span>r[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">}</a></code></pre></div>
<p>Il se peut que pour un article, il n’y ait pas de numéro WOS correspondant. Pour que notre script ne soit pas arrêté en cas d’erreur il faut donc <strong>gérer cette exception</strong>. Nous allons créer un objet <code>tryExtract</code> qui va prendre comme valeur une chaîne de caractères vide <code>&quot;&quot;</code>. Ensuite nous allons essayer avec la fonction <code>try()</code> d’extraire le numéro WOS avec la fonction <code>substr()</code>. Le numéro WOS se situe depuis le caractère numéro 117 jusqu’au caractère numéro 131 de l’URL.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(myDOIs)){</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  myDOI &lt;-<span class="st"> </span>myDOIs[i]</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  myWebPage &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="st">&quot;http://ws.isiknowledge.com/&quot;</span>, </a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="st">&quot;cps/openurl/service?url_ver=Z39.88-2004&quot;</span>, </a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="st">&quot;&amp;rft_id=info:doi/&quot;</span>, myDOI)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">  r &lt;-<span class="st"> </span><span class="kw">GET</span>(myWebPage)</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">  urlWOS &lt;-<span class="st"> </span>r[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">  tryExtract &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  <span class="kw">try</span>(</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    tryExtract &lt;-<span class="st"> </span><span class="kw">substr</span>(</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">      <span class="dt">x =</span> urlWOS, </a>
<a class="sourceLine" id="cb7-13" data-line-number="13">      <span class="dt">start =</span> <span class="dv">117</span>, </a>
<a class="sourceLine" id="cb7-14" data-line-number="14">      <span class="dt">stop =</span> <span class="dv">131</span>), </a>
<a class="sourceLine" id="cb7-15" data-line-number="15">    <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">}</a></code></pre></div>
<p>Nous pouvons ensuite vérifier que l’extraction correspond bien à un numéro en utilisant une <strong>expression régulière</strong>. Ici nous allons simplement vérifier que l’extraction ne contient que des chiffres. Dans le cas contraire <code>tryExtract</code> reprendra sa valeur initiale <code>&quot;&quot;</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(myDOIs)){</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  myDOI &lt;-<span class="st"> </span>myDOIs[i]</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  myWebPage &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="st">&quot;http://ws.isiknowledge.com/&quot;</span>, </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="st">&quot;cps/openurl/service?url_ver=Z39.88-2004&quot;</span>, </a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="st">&quot;&amp;rft_id=info:doi/&quot;</span>, myDOI)</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  r &lt;-<span class="st"> </span><span class="kw">GET</span>(myWebPage)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  urlWOS &lt;-<span class="st"> </span>r[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">  tryExtract &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">  <span class="kw">try</span>(</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">    tryExtract &lt;-<span class="st"> </span><span class="kw">substr</span>(</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">      <span class="dt">x =</span> urlWOS, </a>
<a class="sourceLine" id="cb8-13" data-line-number="13">      <span class="dt">start =</span> <span class="dv">117</span>, </a>
<a class="sourceLine" id="cb8-14" data-line-number="14">      <span class="dt">stop =</span> <span class="dv">131</span>), </a>
<a class="sourceLine" id="cb8-15" data-line-number="15">    <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">grepl</span>(</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">    <span class="dt">pattern =</span> <span class="st">&#39;^[0-9]*$&#39;</span>, </a>
<a class="sourceLine" id="cb8-18" data-line-number="18">    <span class="dt">x =</span> tryExtract)</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">  ){</a>
<a class="sourceLine" id="cb8-20" data-line-number="20">    tryExtract &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21">  }</a>
<a class="sourceLine" id="cb8-22" data-line-number="22">}</a></code></pre></div>
<p>Le résultat est ensuite stocké dans un <code>vector</code> créé au préalable et appelé <code>vecWOS</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">vecWOS &lt;-<span class="st"> </span><span class="kw">vector</span>()</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(myDOIs)){</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  myDOI &lt;-<span class="st"> </span>myDOIs[i]</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  myWebPage &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="st">&quot;http://ws.isiknowledge.com/&quot;</span>, </a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    <span class="st">&quot;cps/openurl/service?url_ver=Z39.88-2004&quot;</span>, </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="st">&quot;&amp;rft_id=info:doi/&quot;</span>, myDOI)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  r &lt;-<span class="st"> </span><span class="kw">GET</span>(myWebPage)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">  urlWOS &lt;-<span class="st"> </span>r[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  tryExtract &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">  <span class="kw">try</span>(</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    tryExtract &lt;-<span class="st"> </span><span class="kw">substr</span>(</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">      <span class="dt">x =</span> urlWOS, </a>
<a class="sourceLine" id="cb9-14" data-line-number="14">      <span class="dt">start =</span> <span class="dv">117</span>, </a>
<a class="sourceLine" id="cb9-15" data-line-number="15">      <span class="dt">stop =</span> <span class="dv">131</span>), </a>
<a class="sourceLine" id="cb9-16" data-line-number="16">    <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">grepl</span>(</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">    <span class="dt">pattern =</span> <span class="st">&#39;^[0-9]*$&#39;</span>, </a>
<a class="sourceLine" id="cb9-19" data-line-number="19">    <span class="dt">x =</span> tryExtract)</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">  ){</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">    tryExtract &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22">  }</a>
<a class="sourceLine" id="cb9-23" data-line-number="23">  vecWOS &lt;-<span class="st"> </span><span class="kw">append</span>(vecWOS, tryExtract)</a>
<a class="sourceLine" id="cb9-24" data-line-number="24">}</a></code></pre></div>
<p>Nous pouvons alors créer un objet de type <code>data.frame</code> qui va contenir les numéros DOI et les numéros WOS, et éventuellement l’exporter dans un fichier CSV.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">dfDOIWOS &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="dt">DOI =</span> myDOIs, </a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="dt">WOS =</span> vecWOS)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw">write.csv</span>(</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">  dfDOIWOS, </a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  <span class="dt">file =</span> <span class="st">&quot;dfDOIWOS.csv&quot;</span>, </a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Le résultat est le suivant (non exécuté car la procédure d’interrogation avec la fonction <code>GET()</code> est très lente : <strong>si nous souhaitons travailler sur un liste de plusieurs dizaines ou centaines d’articles, plusieurs heures seront nécessaires</strong> avant d’obtenir le résultat).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">#                         DOI             WOS</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co"># 1   10.1111/2041-210X.12935 000429421800031</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># 2 10.1007/s13355-017-0480-5 000400381400016</span></a></code></pre></div>
<p>Voici le code complet :</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">pkgCheck &lt;-<span class="st"> </span><span class="cf">function</span>(packages){</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">    <span class="cf">for</span>(x <span class="cf">in</span> packages){</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">        <span class="kw">try</span>(<span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(x, <span class="dt">character.only =</span> <span class="ot">TRUE</span>)){</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">            <span class="kw">install.packages</span>(x, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">            <span class="cf">if</span>(<span class="op">!</span><span class="kw">require</span>(x, <span class="dt">character.only =</span> <span class="ot">TRUE</span>)) {</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">                <span class="kw">stop</span>()</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">            }</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">        })</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">    }</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="kw">pkgCheck</span>(<span class="st">&quot;httr&quot;</span>)</a>
<a class="sourceLine" id="cb12-12" data-line-number="12"></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">myDOIs &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">  <span class="st">&quot;10.1111/2041-210X.12935&quot;</span>, </a>
<a class="sourceLine" id="cb12-15" data-line-number="15">  <span class="st">&quot;10.1007/s13355-017-0480-5&quot;</span>)</a>
<a class="sourceLine" id="cb12-16" data-line-number="16"></a>
<a class="sourceLine" id="cb12-17" data-line-number="17">vecWOS &lt;-<span class="st"> </span><span class="kw">vector</span>()</a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(myDOIs)){</a>
<a class="sourceLine" id="cb12-19" data-line-number="19">  myDOI &lt;-<span class="st"> </span>myDOIs[i]</a>
<a class="sourceLine" id="cb12-20" data-line-number="20">  myWebPage &lt;-<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb12-21" data-line-number="21">    <span class="st">&quot;http://ws.isiknowledge.com/&quot;</span>, </a>
<a class="sourceLine" id="cb12-22" data-line-number="22">    <span class="st">&quot;cps/openurl/service?url_ver=Z39.88-2004&quot;</span>, </a>
<a class="sourceLine" id="cb12-23" data-line-number="23">    <span class="st">&quot;&amp;rft_id=info:doi/&quot;</span>, myDOI)</a>
<a class="sourceLine" id="cb12-24" data-line-number="24">  r &lt;-<span class="st"> </span><span class="kw">GET</span>(myWebPage)</a>
<a class="sourceLine" id="cb12-25" data-line-number="25">  urlWOS &lt;-<span class="st"> </span>r[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb12-26" data-line-number="26">  tryExtract &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb12-27" data-line-number="27">  <span class="kw">try</span>(</a>
<a class="sourceLine" id="cb12-28" data-line-number="28">    tryExtract &lt;-<span class="st"> </span><span class="kw">substr</span>(</a>
<a class="sourceLine" id="cb12-29" data-line-number="29">      <span class="dt">x =</span> urlWOS, </a>
<a class="sourceLine" id="cb12-30" data-line-number="30">      <span class="dt">start =</span> <span class="dv">117</span>, </a>
<a class="sourceLine" id="cb12-31" data-line-number="31">      <span class="dt">stop =</span> <span class="dv">131</span>), </a>
<a class="sourceLine" id="cb12-32" data-line-number="32">    <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-33" data-line-number="33">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">grepl</span>(</a>
<a class="sourceLine" id="cb12-34" data-line-number="34">    <span class="dt">pattern =</span> <span class="st">&#39;^[0-9]*$&#39;</span>, </a>
<a class="sourceLine" id="cb12-35" data-line-number="35">    <span class="dt">x =</span> tryExtract)</a>
<a class="sourceLine" id="cb12-36" data-line-number="36">  ){</a>
<a class="sourceLine" id="cb12-37" data-line-number="37">    tryExtract &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb12-38" data-line-number="38">  }</a>
<a class="sourceLine" id="cb12-39" data-line-number="39">  vecWOS &lt;-<span class="st"> </span><span class="kw">append</span>(vecWOS, tryExtract)</a>
<a class="sourceLine" id="cb12-40" data-line-number="40">}</a>
<a class="sourceLine" id="cb12-41" data-line-number="41"></a>
<a class="sourceLine" id="cb12-42" data-line-number="42">dfDOIWOS &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">DOI =</span> myDOIs, <span class="dt">WOS =</span> vecWOS)</a>
<a class="sourceLine" id="cb12-43" data-line-number="43"><span class="kw">write.csv</span>(</a>
<a class="sourceLine" id="cb12-44" data-line-number="44">  dfDOIWOS, </a>
<a class="sourceLine" id="cb12-45" data-line-number="45">  <span class="dt">file =</span> <span class="st">&quot;dfDOIWOS.csv&quot;</span>, </a>
<a class="sourceLine" id="cb12-46" data-line-number="46">  <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>La boucle <code>for()</code> pourrait être remplacée par une boucle <code>sapply()</code> pour gagner en temps d’exécution. Un gain serait également possible en effectuant une parallélisation sur cette boucle. Pour information, voici un exemple de temps d’exécution renvoyé par la fonction <code>system.time()</code> et <code>microbenchmark::microbenchmark()</code> :</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># system.time()</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">#   user  system elapsed</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">#   0.10    0.01   35.00</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co"># microbenchmark()</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co"># Unit: seconds</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#     expr    min     lq    mean median     uq    max neval</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#  myFun() 36.589 36.589 36.589  36.589 36.589 36.589     1</span></a></code></pre></div>
<p>Nous venons de faire un script qui permet à partir d’une liste de numéros DOI d’obtenir automatiquement les numéros WOS.</p>

</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["myRBook_FR.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
